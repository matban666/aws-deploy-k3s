---
- hosts: all
  become: yes
  tasks:
    - name: Download k3s installation script
      get_url:
        url: https://get.k3s.io
        dest: /tmp/install_k3s.sh
        mode: '0755'
        
    # - name: Set K3S_KUBECONFIG_MODE environment variable
    #   set_fact:
    #     K3S_KUBECONFIG_MODE_FACT: "644"

    # - name: Set INSTALL_K3S_SELINUX_WARN environment variable
    #   set_fact:
    #     INSTALL_K3S_SELINUX_WARN_FACT: "true" 
    
    # - name: Set INSTALL_K3S_SKIP_SELINUX_RPM environment variable
    #   set_fact:
    #     INSTALL_K3S_SKIP_SELINUX_RPM_FACT: "true"

    - name: Install k3s
      command: K3S_KUBECONFIG_MODE=644 INSTALL_K3S_SELINUX_WARN=true INSTALL_K3S_SKIP_SELINUX_RPM=true /tmp/install_k3s.sh
      # environment:
      #   K3S_KUBECONFIG_MODE: "{{ K3S_KUBECONFIG_MODE_FACT }}"
      #   INSTALL_K3S_SELINUX_WARN: "{{ INSTALL_K3S_SELINUX_WARN_FACT }}"
      #   INSTALL_K3S_SKIP_SELINUX_RPM: "{{ INSTALL_K3S_SKIP_SELINUX_RPM_FACT }}"
